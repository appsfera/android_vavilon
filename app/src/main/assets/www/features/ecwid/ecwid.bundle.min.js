angular.module("starter").controller("EcwidIndexController",function($scope,$stateParams,$state,$translate,$timeout,Dialog,Ecwid,EcwidManager){angular.extend($scope,{isLoading:!0,value_id:$stateParams.value_id,pageTitle:$translate.instant("Ecwid","ecwid"),store_id:null,ecwid:{title:"Главная",subtitle:"",},});EcwidManager.showLoading();EcwidManager.getSavedMail();$scope.ecwid.customerIsLoggedIn=!!EcwidManager.customer_mail
Ecwid.setValueId($stateParams.value_id);EcwidManager.setValueId($stateParams.value_id)
$scope.loadContent=function(refresh){Ecwid.loadContent(refresh).then(function(payload){$timeout(function(){$scope.pageTitle=payload.pageTitle;$scope.ecwid_data=payload.ecwid_data;EcwidManager.store_id=$scope.store_id=payload.ecwid_data.store_id});EcwidManager.hideLoading();$scope.isLoading=!1},function(error){EcwidManager.hideLoading();$scope.isLoading=!1;Dialog.alert("Error",error.message,"OK",3500,"ecwids")})};$scope.refresh=function(){$scope.loadContent(!0)};$scope.loadContent(!1);$scope.goTo=function(state){$state.go("ecwid-"+state,{value_id:$scope.value_id})};$scope.openLink=function(url){if($rootScope.isOverview){$rootScope.showMobileFeatureOnlyError();return}
$window.open(url,'_system')}});angular.module("starter").controller('EcwidCustomerController',function($scope,$stateParams,$state,$translate,$timeout,Dialog,Ecwid,EcwidManager){$scope.value_id=Ecwid.value_id=EcwidManager.value_id;EcwidManager.showLoading()
$scope.customer={loaded:!1};$scope.customer.loaded=EcwidManager.customer.loaded;$scope.customer.customer_mail=''
if(EcwidManager.customer_mail){EcwidManager.showLoading()
$scope.customer.customer_mail=EcwidManager.customer_mail
Ecwid.getCustomer(EcwidManager.customer_mail).then(function(response_data){$scope.customer.loaded=EcwidManager.customer.loaded=!0
angular.extend($scope.customer,response_data.ecwid_data.items[0])
EcwidManager.hideLoading()},function(error){console.log(error)
EcwidManager.hideLoading()})}else{$scope.setCustomer=function(){EcwidManager.showLoading()
Ecwid.getCustomer($scope.customer.customer_mail).then(function(response_data){$scope.customer.loaded=EcwidManager.customer.loaded=!0
EcwidManager.customer_mail=$scope.customer.customer_mail
EcwidManager.saveMail()
angular.extend($scope.customer,response_data.ecwid_data.items[0])
EcwidManager.hideLoading()},function(error){console.log(error)
EcwidManager.hideLoading()})}}
EcwidManager.hideLoading()});angular.module("starter").controller('EcwidNewcustomerController',function($scope,$stateParams,$state,$translate,$timeout,Dialog,Ecwid,EcwidManager){$scope.value_id=Ecwid.value_id=EcwidManager.value_id;EcwidManager.showLoading()
$scope.customer={};$scope.customer.customer_mail=''
$scope.customer.customer_pass=''
$scope.createCustomer=function(){EcwidManager.showLoading()
Ecwid.createCustomer($scope.customer.customer_mail,$scope.customer.customer_pass).then(function(response_data){EcwidManager.customer.loaded=!0
EcwidManager.customer_mail=$scope.customer.customer_mail
EcwidManager.saveMail()
EcwidManager.hideLoading();$state.go("ecwid-index",{value_id:$scope.value_id})},function(error){console.log(error)
EcwidManager.hideLoading()})}
EcwidManager.hideLoading()});angular.module("starter").factory("Ecwid",function($pwaRequest){var factory={value_id:null,extendedOptions:{}};factory.setValueId=function(valueId){factory.value_id=valueId};factory.loadContent=function(refresh){return $pwaRequest.get('ecwid/mobile_view/load',{urlParams:{value_id:factory.value_id},cache:!refresh})};factory.getCustomer=function(mail){return $pwaRequest.post('ecwid/mobile_view/checkcustomer',{data:{customer_mail:mail},urlParams:{value_id:factory.value_id,},})}
factory.createCustomer=function(mail,pass){return $pwaRequest.post('ecwid/mobile_view/createcustomer',{data:{customer_mail:mail,customer_pass:pass},urlParams:{value_id:factory.value_id,},})}
return factory});angular.module("starter").service("EcwidManager",function(Loader){console.log('wearehere')
let service={}
service.init=function(){service.value_id=null;service.customer={customer_mail:null,loaded:!1}
service.store_id=null}
service.setValueId=function(id){service.value_id=id}
service.saveMail=function(){if(typeof localStorage!='undefined'){var mail_json=JSON.stringify(service.customer_mail);localStorage.setItem("ecwid_customer_mail_"+service.value_id,mail_json)}}
service.getSavedMail=function(){if(localStorage.getItem("ecwid_customer_mail_"+service.value_id)!=null){var mail_json=localStorage.getItem("ecwid_customer_mail_"+service.value_id);service.customer_mail=JSON.parse(mail_json)}};service.showLoading=function(){Loader.show()};service.hideLoading=function(){Loader.hide()};if(typeof EcwidManager=="undefined"){service.init()}
return service});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.module-skeleton .content img{max-width:100%;height:auto}.module-skeleton .content p{margin-bottom:1em}","ecwid")